<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title></title>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.4.2.js"></script>
<script type="text/javascript" src="shared.js"></script>
<script type="text/javascript" src="table.js"></script>

<script type="text/javascript">

var users;
var table;

function onload()
{
	table = new LoadableTable(document.getElementById("dataTable").children[0]);
	
	updateRows();
}

function updateRows()
{
	table.clear();
	table.setLoading(true);
	callAPI({request:"getUsers"}, onUsersLoaded);
}

function onUsersLoaded(data)
{
	users = data;
	
	table.setLoading(false);
	table.clear();
	
	var X;
	var userRow;
	for(X in data)
	{
		userRow = table.createRow();
		fillRowWithUser(userRow, data[X]);
	}
}

function fillRowWithUser(tableRow, user)
{
	var cells = tableRow.getElementsByTagName("td");
	cells[0].innerHTML = user.name
	cells[1].innerHTML = user.soloWins ? user.soloWins : "";
	cells[2].innerHTML = user.duoWins ? user.duoWins : "";;
}

function addUser()
{
	if(users == null)
	{
		alert("User loading in progress.");
		return;
	}
	var username = prompt("Enter your name to add : ", "your name here");
	if(username == null)
	{
		return;
	}
	if(findUserByName(users, username))
	{
		alert("User already exists : " +  username );
	}
	else
	{
		var yes = confirm("Do you really want to add new user '" + username+ "'?");
	   if( yes )
	   {
			callAPI({request:"addUser", name:username}, onUsersAdded);
	   }
	}
}

function onUsersAdded(data)
{
	updateRows();
}

</script>
</head>
<body onload="onload();">
<p><a href="index.html">HOME</a> | <a href="javascript:addUser()">ADD USER</a></p>
<table width="400" border="0" align="center" id="dataTable">
  <tr>
    <td bgcolor="#999999">Name</td>
    <td bgcolor="#999999">Solo wins</td>
    <td bgcolor="#999999">Duo wins</td>
  </tr>
  <tr id="loadingRow">
    <td colspan="3" align="center" bgcolor="#FFCC00">Getting users...</td>
  </tr>
  <tr id="sampleRow">
    <td>NAME</td>
    <td align="center">SOLO WINS</td>
    <td align="center">DUO WINS</td>
  </tr>
</table>
<p>&nbsp;</p>
</body>
</html>
